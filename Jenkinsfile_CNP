#!groovy
@Library("Infrastructure") _

def product = "sscs"
def component = "tya-frontend"

def yarnBuilder = new uk.gov.hmcts.contino.YarnBuilder(this)

withPipeline("nodejs", product, component) {
  enableDockerBuild()
  installCharts()

  enableAksStagingDeployment()
  disableLegacyDeploymentOnAAT()

  after('build') {
    yarnBuilder.yarn('setup')
  }

  after("smoketest:preview") {
      stage('Application URLs') {
        def AppDevUrl = env.TEST_URL.replace("https", "http")
        AppDevUrl = AppDevUrl.replace("-staging.", ".")
        println "Application URL: " + AppDevUrl
        println "Healthcheck URL: " + AppDevUrl + "/health"
        println "Kudu URL: " + AppDevUrl.replace(".service.", ".scm.service.")
      }
  }
}
